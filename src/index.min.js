import{default as VercelApi}from"./Api/vercelApi.min.js";(()=>{let e,t=new Image,n="",r="",a=!1,i=document.getElementById("location-input"),o=document.getElementById("background-one"),l=document.getElementById("background-two"),d=document.getElementById("week-overview"),c=document.getElementById("weather-locations"),u={sunrise:document.getElementById("current-weather-sunrise"),sunset:document.getElementById("current-weather-sunset"),humidity:document.getElementById("current-weather-humidity"),wind:document.getElementById("current-weather-wind"),pressure:document.getElementById("current-weather-pressure"),temp:document.getElementById("current-weather-temp"),city:document.getElementById("current-weather-city"),description:document.getElementById("current-weather-description"),time:document.getElementById("current-weather-time"),date:document.getElementById("current-weather-date"),icon:document.getElementById("current-weather-icon")};const s=e=>{let t=e[0].urls.regular;if(e.length>1){let i=(n=0,a=e.length,Math.floor(Math.random()*a-n)+n);t=e[i].urls.regular,t===r&&(i=++i%e.length,t=e[i].urls.regular)}var n,a;return t},m=n=>{if(a)return;let i=Number(o.style.zIndex)>Number(l.style.zIndex),d=i?o:l,c=i?l:o;t.onload=n=>{c.style.backgroundImage=`url('${t.src}')`;var r=1;a=!0,e=setInterval((()=>{r-=.05,d.style.opacity=`${r}`,r<=0&&(c.style.zIndex="-1",d.style.zIndex="-2",d.style.opacity="100%",clearInterval(e),a=!1)}),50)},t.src=n,r=n},w=e=>{let t=new Date(1e3*e.sunrise),n=new Date(1e3*e.sunset),r=new Date(1e3*e.dt);const a={hour:"numeric",minute:"numeric",hour12:!0};let i=(new Date).toLocaleString(void 0,a).split(" "),o=`${i[0]} ${i[1].fontsize(6)}`,l=new Intl.DateTimeFormat(void 0,{weekday:"long",day:"numeric",month:"long",year:"numeric"}).format(r);u.sunrise.innerHTML=`${t.toLocaleString(void 0,a)}`,u.sunset.innerHTML=`${n.toLocaleString(void 0,a)}`,u.humidity.innerHTML=`${e.humidity} %`,u.wind.innerHTML=`${e.wind_speed} km/h`,u.pressure.innerHTML=`${e.pressure} hPa`,u.temp.innerHTML=`${parseInt(e.temp)}Â°`,u.description.innerHTML=e.weather[0].description,u.time.innerHTML=o,u.date.innerHTML=l,u.icon.className=`weather-icon owf owf-${e.weather[0].id} owf-5x`},y=e=>{let t=Math.min(6,e.length);d.innerHTML="";for(let r=1;r<t;r++){let t=new Date(1e3*e[r].dt).toLocaleDateString(void 0,{weekday:"long"}),a=e[r].temp.day,i=e[r].weather[0].id,o=g(d,{weekday:t,temp:a});var n=document.createElement("i");n.className=`owf owf-${i} owf-1x`,o.insertCell().appendChild(n),o.onclick=()=>{w(e[r])}}},g=(e,t)=>{let n=e.insertRow();return Object.values(t).forEach((e=>{let t=n.insertCell(),r=document.createTextNode(e);t.appendChild(r)})),n},h=e=>{if(!(void 0!==Array.from(document.querySelectorAll("#weather-locations > option")).find((t=>t.value.toLowerCase()==e.toLowerCase())))){var t=document.createElement("option");t.value=e,c.appendChild(t)}},p=async e=>{let t=await VercelApi.getWeeklyWeatherDataForLocation(e);var r;return n=e,r=t,u.city.innerHTML=r.name,w(r.current),y(r.daily),(async(e,t=!0)=>{let n=await VercelApi.getPictures(`${e}`,t?10:0);if(n){let e=t?s(n):n[0].urls.regular;m(e)}})(`${t.name} ${t.current.weather[0].main}`,!0),!0},v=async e=>{e.preventDefault(),await p(i.value)?(h(i.value),i.value=""):(i.classList.add("error"),setTimeout((function(){i.classList.remove("error"),i.value=""}),1e3))};document.getElementById("search-weather-button").addEventListener("click",v),i.addEventListener("submit",v),i.addEventListener("keyup",(e=>{"Enter"===e.key&&v(e)})),(async()=>{let e=await VercelApi.getAddressFromIP(),t=e?.city??e?.region;t&&(h(t),p(t))})(),(()=>{let e=60-(new Date).getSeconds();setTimeout((()=>{n&&p(n),setInterval((()=>{p(n)}),6e4)}),1e3*e)})()})();