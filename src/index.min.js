import{default as VercelApi}from"./Api/vercelApi.min.js";(()=>{let e,t=new Image,n="",r="",a=!1,o=document.getElementById("location-input"),i=document.getElementById("background-one"),l=document.getElementById("background-two"),c=document.getElementById("week-overview"),d=document.getElementById("weather-locations"),u={sunrise:document.getElementById("current-weather-sunrise"),sunset:document.getElementById("current-weather-sunset"),humidity:document.getElementById("current-weather-humidity"),wind:document.getElementById("current-weather-wind"),pressure:document.getElementById("current-weather-pressure"),temp:document.getElementById("current-weather-temp"),city:document.getElementById("current-weather-city"),description:document.getElementById("current-weather-description"),time:document.getElementById("current-weather-time"),date:document.getElementById("current-weather-date"),icon:document.getElementById("current-weather-icon")};const s=e=>{let t=e[0].urls.regular;if(e.length>1){let o=(n=0,a=e.length,Math.floor(Math.random()*a-n)+n);t=e[o].urls.regular,t===r&&(o=++o%e.length,t=e[o].urls.regular)}var n,a;return t},m=n=>{if(a)return;let o=Number(i.style.zIndex)>Number(l.style.zIndex),c=o?i:l,d=o?l:i;t.onload=n=>{d.style.backgroundImage=`url('${t.src}')`;var r=1;a=!0,e=setInterval((()=>{r-=.05,c.style.opacity=`${r}`,r<=0&&(d.style.zIndex="-1",c.style.zIndex="-2",c.style.opacity="100%",clearInterval(e),a=!1)}),50)},t.src=n,r=n},y=e=>{let t=new Date(1e3*e.sunrise),n=new Date(1e3*e.sunset),r=new Date(1e3*e.dt);const a={hour:"numeric",minute:"numeric",hour12:!0};let o=(new Date).toLocaleString(void 0,a).split(" "),i=`${o[0]} ${o[1].fontsize(6)}`,l=new Intl.DateTimeFormat(void 0,{weekday:"long",day:"numeric",month:"long",year:"numeric"}).format(r);u.sunrise.innerHTML=`${t.toLocaleString(void 0,a)}`,u.sunset.innerHTML=`${n.toLocaleString(void 0,a)}`,u.humidity.innerHTML=`${e.humidity} %`,u.wind.innerHTML=`${e.wind_speed} km/h`,u.pressure.innerHTML=`${e.pressure} hPa`,u.temp.innerHTML=`${parseInt(e.temp)}Â°`,u.description.innerHTML=e.weather[0].description,u.time.innerHTML=i,u.date.innerHTML=l,u.icon.className=`weather-icon owf owf-${e.weather[0].id} owf-5x`},w=e=>{let t=Math.min(6,e.length);c.innerHTML="";for(let r=1;r<t;r++){let t=new Date(1e3*e[r].dt).toLocaleDateString(void 0,{weekday:"long"}),a=e[r].temp.day,o=e[r].weather[0].id,i=g(c,{weekday:t,temp:a});var n=document.createElement("i");n.className=`owf owf-${o} owf-1x`,i.insertCell().appendChild(n),i.onclick=()=>{y(e[r])}}},g=(e,t)=>{let n=e.insertRow();return Object.values(t).forEach((e=>{let t=n.insertCell(),r=document.createTextNode(e);t.appendChild(r)})),n},h=e=>{if(!(void 0!==Array.from(document.querySelectorAll("#weather-locations > option")).find((t=>t.value.toLowerCase()==e.toLowerCase())))){var t=document.createElement("option");t.value=e,d.appendChild(t)}},p=async e=>{let t=await VercelApi.getWeeklyWeatherDataForLocation(e);var r;return n=e,r=t,u.city.innerHTML=r.name,y(r.current),w(r.daily),(async(e,t=!0)=>{let n=await VercelApi.getPictures(`${e}`,t?10:0);if(n){let e=t?s(n):n[0].urls.regular;m(e)}})(`${t.name} ${t.current.weather[0].main}`,!0),!0},v=async e=>{let t=await VercelApi.getAddressFromLatLng(e.coords.latitude,e.coords.longitude),n=t?.components?.city??t?.components?.village??t?.components?.county;n&&(h(n),p(n))},I=e=>{},L=async e=>{e.preventDefault(),await p(o.value)?(h(o.value),o.value=""):(o.classList.add("error"),setTimeout((function(){o.classList.remove("error"),o.value=""}),1e3))};document.getElementById("search-weather-button").addEventListener("click",L),o.addEventListener("submit",L),o.addEventListener("keyup",(e=>{"Enter"===e.key&&L(e)})),navigator.geolocation&&navigator.geolocation.getCurrentPosition(v,I),(()=>{let e=60-(new Date).getSeconds();setTimeout((()=>{n&&p(n),setInterval((()=>{p(n)}),6e4)}),1e3*e)})()})();